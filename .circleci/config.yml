version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@1.0.0

workflows:
  dispatch:
    jobs:
      - path-filtering/filter:
          name: workflow-dispatch
          mapping: |
            aws-web/.* aws-web true
            identity-center/.* identity-center true
            openai-web/.* openai-web true
          base-revision: master
          config-path: .circleci/next.yml
          config-yml-out: .circleci/generated_config.yml

# Workflows to trigger the builds based on the dynamic configuration
workflows:
  aws-web:
    when: << pipeline.parameters.aws-web >>
    jobs:
      - setup:
          name: "Setup AWS Web"
          command: circleci config process .circleci/generated_config.yml > processed.yml
      - aws-web-build

  identity-center:
    when: << pipeline.parameters.identity-center >>
    jobs:
      - setup:
          name: "Setup Identity Center"
          command: circleci config process .circleci/generated_config.yml > processed.yml
      - identity-center-build

  openai-web:
    when: << pipeline.parameters.openai-web >>
    jobs:
      - setup:
          name: "Setup OpenAI Web"
          command: circleci config process .circleci/generated_config.yml > processed.yml
      - openai-web-build
